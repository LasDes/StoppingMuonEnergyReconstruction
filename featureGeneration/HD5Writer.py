"""HD5Writer.
Usage: HD5Writer.py INPUT OUTPUT [--exp --mgs --nu]

-h --help  Show this screen.
INPUT      Input path in bash script.
OUTPUT     Output path to HDF5 file
--exp      Flag for experimental data.
--mgs      Flag for muongun simulation data.
--nu      Flag for nu generator data.
"""
#
# Writes I3 Files to HD5 Files.
# 
# 2016 T. Hoinka (tobias.hoinka@udo.edu)
#

import sys
import os
import glob
from docopt import docopt

import numpy as np
from icecube import icetray, dataclasses, dataio, simclasses, gulliver, linefit, paraboloid, millipede, common_variables, cramer_rao
from I3Tray import *
from icecube.tableio import I3TableWriter
from icecube.hdfwriter import I3HDFTableService


def main(input, output, exp, mgs, nu):
    if exp: print("exp flag was set!")
    if mgs: print("mgs flag was set!")
    if nu: print("nu flag was set!")
    if exp is True:
        keys = ["HoinkaAttributes"]
    else:
        keys = ["CorsikaWeightMap",
                "SplineMPETruncatedEnergy_SPICEMie_AllDOMS_dEdX",
                "Hoinka_charge_v3_HVInIcePulses_all_out",
                "LineFitTimeSplit1Params",
                "SplineMPE_MillipedeHighEnergyMIEFitParams",
                "MPEFit_TWHV",
                "SplineMPETruncatedEnergy_SPICEMie_ORIG_Neutrino",
                "SplineMPETruncatedEnergy_SPICEMie_ORIG_Muon",
                "SplineMPETruncatedEnergy_SPICEMie_DOMS_Neutrino",
                "SplineMPETruncatedEnergy_SPICEMie_DOMS_Muon",
                "SplineMPETruncatedEnergy_SPICEMie_DOMS_MuEres",
                "Hoinka_emptybins_60_HVInIcePulses",
                "SplineMPETruncatedEnergy_SPICEMie_AllDOMS_Neutrino",
                "BestTrackDirectHitsICB",
                "Hoinka_z_travel_TWSRTHVInIcePulses",
                "SplineMPETruncatedEnergy_SPICEMie_AllDOMS_Muon",
                "Hoinka_q_tot_pulses_InIcePulses",
                "SplineMPEMuEXDifferential_r",
                "Hoinka_convhull_vol_HVInIcePulses",
                "Hoinka_bins_std_120_InIcePulses",
                "SplineMPEDirectHitsD",
                "SplineMPECramerRaoParams",
                "SplineMPECharacteristicsIC",
                "SRTHVInIcePulses_QtotWithDC",
                "Hoinka_z_mean_TWSRTHVInIcePulses",
                "SPEFitSingle_TWHV",
                "Hoinka_convhull_surf_InIcePulses",
                "SPEFitSingle_HVFitParams",
                "SPEFitSingle_HV",
                "Hoinka_bins_mean_100_HVInIcePulses",
                "SPEFit2_HVFitParams",
                "Hoinka_proj_track_6_TWSRTHVInIcePulses",
                "BestTrackDirectHitsE",
                "Hoinka_stop_point_z_6_InIcePulses",
                "SPEFit2BayesianFitParams",
                "MuEXAngular4_rllt",
                "Hoinka_proj_track_3_InIcePulses",
                "MuEXAngular4",
                "Hoinka_bins_frame_120_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_20_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_100_BS_TWSRTHVInIcePulses",
                "Hoinka_sphericalness_HVInIcePulses",
                "MPEFit_TWHVFitParams",
                "MPEFitParaboloidFitParams",
                "Hoinka_stop_point_proj_6_HVInIcePulses",
                "Hoinka_charge_v3_HVInIcePulses_corridor_out",
                "SPEFit2Bayesian",
                "Hoinka_emptybins_20_N_HVInIcePulses",
                "Hoinka_q_tot_pulses_HVInIcePulses",
                "Hoinka_stop_point_z_4_HVInIcePulses",
                "LineFit_TWHVParams",
                "Hoinka_stop_point_proj_5_HVInIcePulses",
                "LineFit_TWHV",
                "Hoinka_bins_std_20_HVInIcePulses",
                "Hoinka_proj_track_6_HVInIcePulses",
                "Hoinka_dustiness_b_SplineMPE",
                "Hoinka_zenith_SplineMPE",
                "Hoinka_z_travel_HVInIcePulses",
                "Hoinka_charge_v1_InIcePulses_all_in",
                "Hoinka_z_sigma_TWSRTHVInIcePulses",
                "Hoinka_z_min_InIcePulses",
                "Hoinka_z_mean_InIcePulses",
                "Hoinka_emptybins_80_HVInIcePulses",
                "Hoinka_z_mean_HVInIcePulses",
                "Hoinka_z_max_TWSRTHVInIcePulses",
                "Hoinka_time_std_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_6_TWSRTHVInIcePulses",
                "Hoinka_time_std_InIcePulses",
                "Hoinka_charge_v5_TWSRTHVInIcePulses_all_out",
                "Hoinka_time_std_HVInIcePulses",
                "Hoinka_time_frame_InIcePulses",
                "Hoinka_time_frame_HVInIcePulses",
                "Hoinka_stop_point_r_1_InIcePulses",
                "Hoinka_z_max_InIcePulses",
                "Hoinka_dir_track_length_HVInIcePulses",
                "Hoinka_stop_point_z_9_InIcePulses",
                "Hoinka_stop_point_z_9_HVInIcePulses",
                "Hoinka_stop_point_z_8_TWSRTHVInIcePulses",
                "Hoinka_emptybins_20_InIcePulses",
                "Hoinka_stop_point_z_8_HVInIcePulses",
                "Hoinka_emptybins_100_HVInIcePulses",
                "Hoinka_stop_point_z_7_InIcePulses",
                "Hoinka_charge_v2_HVInIcePulses_corridor_in",
                "Hoinka_stop_point_z_5_HVInIcePulses",
                "MPEFit_HVFitParams",
                "Hoinka_stop_point_z_4_TWSRTHVInIcePulses",
                "Hoinka_emptybins_80_N_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_3_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_3_HVInIcePulses",
                "Hoinka_proj_track_5_HVInIcePulses",
                "Hoinka_stop_point_z_2_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_2_InIcePulses",
                "Hoinka_stop_point_z_1_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_1_InIcePulses",
                "Hoinka_stop_point_z_1_HVInIcePulses",
                "SplineMPECharacteristics",
                "Hoinka_stop_point_r_9_InIcePulses",
                "Hoinka_emptybins_60_N_InIcePulses",
                "Hoinka_stop_point_r_7_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_20_BS_HVInIcePulses",
                "Hoinka_stop_point_r_5_HVInIcePulses",
                "Hoinka_stop_point_r_4_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_4_InIcePulses",
                "Hoinka_stop_point_r_4_HVInIcePulses",
                "Hoinka_stop_point_r_3_InIcePulses",
                "Hoinka_stop_point_r_3_HVInIcePulses",
                "Hoinka_cv_n_early_doms_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_2_TWSRTHVInIcePulses",
                "BestTrackCharacteristics",
                "Hoinka_Qdensity_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_2_InIcePulses",
                "Hoinka_cv_ehtl_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_1_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_80_BS_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_8_InIcePulses",
                "Hoinka_stop_point_proj_8_HVInIcePulses",
                "Hoinka_stop_point_proj_7_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_6_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_6_InIcePulses",
                "Hoinka_bins_mean_100_BS_InIcePulses",
                "Hoinka_proj_std_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_4_InIcePulses",
                "Hoinka_bins_std_40_BS_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_4_HVInIcePulses",
                "Hoinka_stop_point_proj_2_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_2_InIcePulses",
                "Hoinka_stop_point_proj_2_HVInIcePulses",
                "Hoinka_stop_point_proj_1_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_1_HVInIcePulses",
                "Hoinka_bins_mean_20_HVInIcePulses",
                "Hoinka_sphericalness_InIcePulses",
                "Hoinka_rlogl_SplineMPE",
                "Hoinka_q_max_doms_TWSRTHVInIcePulses",
                "Hoinka_q_max_doms_InIcePulses",
                "Hoinka_proj_track_9_TWSRTHVInIcePulses",
                "Hoinka_proj_track_9_InIcePulses",
                "Hoinka_proj_track_8_InIcePulses",
                "Hoinka_bins_frame_80_BS_TWSRTHVInIcePulses",
                "Hoinka_z_min_HVInIcePulses",
                "Hoinka_z_sigma_InIcePulses",
                "Hoinka_proj_track_8_HVInIcePulses",
                "Hoinka_proj_track_7_TWSRTHVInIcePulses",
                "Hoinka_proj_track_5_TWSRTHVInIcePulses",
                "Hoinka_charge_v4_InIcePulses_corridor_out",
                "SplineMPEMuEXDifferential",
                "Hoinka_proj_track_4_TWSRTHVInIcePulses",
                "Hoinka_proj_track_4_InIcePulses",
                "Hoinka_proj_track_4_HVInIcePulses",
                "Hoinka_proj_track_3_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_9_InIcePulses",
                "Hoinka_proj_track_3_HVInIcePulses",
                "Hoinka_proj_track_2_InIcePulses",
                "Hoinka_stop_point_proj_3_TWSRTHVInIcePulses",
                "Hoinka_proj_track_2_HVInIcePulses",
                "Hoinka_emptybins_40_BS_InIcePulses",
                "Hoinka_proj_track_1_InIcePulses",
                "Hoinka_bins_std_60_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_5_InIcePulses",
                "Hoinka_proj_track_1_HVInIcePulses",
                "Hoinka_proj_std_HVInIcePulses",
                "Hoinka_proj_frame_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_2_HVInIcePulses",
                "Hoinka_proj_frame_InIcePulses",
                "Hoinka_cv_thsl_InIcePulses",
                "Hoinka_stop_point_proj_9_TWSRTHVInIcePulses",
                "Hoinka_proj_frame_HVInIcePulses",
                "Hoinka_posz_SplineMPE",
                "Hoinka_posy_SplineMPE",
                "Hoinka_nmini_SplineMPE",
                "Hoinka_ndof_SplineMPE",
                "SplineMPETruncatedEnergy_SPICEMie_DOMS_dEdX",
                "Hoinka_bins_frame_100_HVInIcePulses",
                "Hoinka_bins_frame_80_InIcePulses",
                "Hoinka_n_pulses_TWSRTHVInIcePulses",
                "Hoinka_q_max_doms_HVInIcePulses",
                "Hoinka_n_hit_strings_TWSRTHVInIcePulses",
                "SPEFit2_TWHVFitParams",
                "Hoinka_n_hit_strings_InIcePulses",
                "Hoinka_n_hit_strings_HVInIcePulses",
                "BestTrackDirectHitsD",
                "Hoinka_bins_mean_40_InIcePulses",
                "Hoinka_stop_point_proj_3_HVInIcePulses",
                "Hoinka_bins_mean_100_BS_HVInIcePulses",
                "Hoinka_n_hit_doms_InIcePulses",
                "Hoinka_charge_v2_TWSRTHVInIcePulses_all_out",
                "Hoinka_n_hit_doms_1_InIcePulses",
                "Hoinka_emptybins_60_BS_InIcePulses",
                "Hoinka_n_hit_doms_1_HVInIcePulses",
                "Hoinka_CR_covphiy_SplineMPE",
                "Hoinka_min_pulse_time_HVInIcePulses",
                "Hoinka_max_pulse_time_HVInIcePulses",
                "Hoinka_logl_SplineMPE",
                "Hoinka_freelength_TWSRTHVInIcePulses",
                "Hoinka_freelength_HVInIcePulses",
                "SPEFitSingle_TWHVFitParams",
                "Hoinka_exit_z_SplineMPE",
                "Hoinka_stop_point_r_9_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_9_HVInIcePulses",
                "Hoinka_energy_trun_O_mu",
                "Hoinka_energy_trun_D_mu",
                "Hoinka_emptybins_80_TWSRTHVInIcePulses",
                "Hoinka_charge_v5_TWSRTHVInIcePulses_corridor_in",
                "SplineMPEDirectHitsC",
                "Hoinka_emptybins_80_N_InIcePulses",
                "Hoinka_bins_frame_100_BS_TWSRTHVInIcePulses",
                "MPEFit_HV",
                "Hoinka_charge_v4_HVInIcePulses_all_in",
                "Hoinka_emptybins_120_N_HVInIcePulses",
                "Hoinka_emptybins_80_InIcePulses",
                "Hoinka_cv_addqtd_InIcePulses",
                "Hoinka_emptybins_80_BS_TWSRTHVInIcePulses",
                "Hoinka_emptybins_80_BS_HVInIcePulses",
                "Hoinka_cv_ehtl_HVInIcePulses",
                "Hoinka_emptybins_60_N_TWSRTHVInIcePulses",
                "Hoinka_emptybins_60_N_HVInIcePulses",
                "Hoinka_emptybins_60_InIcePulses",
                "Hoinka_emptybins_80_BS_InIcePulses",
                "Hoinka_emptybins_60_BS_HVInIcePulses",
                "Hoinka_stop_point_r_3_TWSRTHVInIcePulses",
                "Hoinka_emptybins_40_N_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_7_HVInIcePulses",
                "Hoinka_travellength_SplineMPE",
                "Hoinka_emptybins_40_InIcePulses",
                "Hoinka_emptybins_20_HVInIcePulses",
                "Hoinka_stop_point_r_6_TWSRTHVInIcePulses",
                "Hoinka_emptybins_40_HVInIcePulses",
                "LineFit_HV",
                "Hoinka_emptybins_20_TWSRTHVInIcePulses",
                "Hoinka_emptybins_20_N_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_5_InIcePulses",
                "Hoinka_emptybins_20_BS_TWSRTHVInIcePulses",
                "Hoinka_emptybins_20_BS_InIcePulses",
                "Hoinka_emptybins_20_BS_HVInIcePulses",
                "Hoinka_emptybins_120_InIcePulses",
                "Hoinka_q_tot_pulses_TWSRTHVInIcePulses",
                "Hoinka_emptybins_120_HVInIcePulses",
                "Hoinka_emptybins_120_BS_HVInIcePulses",
                "Hoinka_posx_SplineMPE",
                "Hoinka_emptybins_100_TWSRTHVInIcePulses",
                "Hoinka_emptybins_100_N_InIcePulses",
                "Hoinka_stop_point_z_3_InIcePulses",
                "Hoinka_proj_track_8_TWSRTHVInIcePulses",
                "Hoinka_emptybins_100_N_HVInIcePulses",
                "Hoinka_stop_point_z_7_TWSRTHVInIcePulses",
                "Hoinka_min_pulse_time_InIcePulses",
                "Hoinka_cv_n_early_strings_InIcePulses",
                "Hoinka_emptybins_100_InIcePulses",
                "Hoinka_emptybins_100_BS_TWSRTHVInIcePulses",
                "Hoinka_n_hit_doms_1_TWSRTHVInIcePulses",
                "Hoinka_emptybins_100_BS_HVInIcePulses",
                "Hoinka_proj_track_6_InIcePulses",
                "Hoinka_cv_n_early_pulses_InIcePulses",
                "Hoinka_cv_q_early_pulses_InIcePulses",
                "Hoinka_stop_point_r_7_InIcePulses",
                "Hoinka_dustiness_a_SplineMPE",
                "Hoinka_dist_std_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_5_InIcePulses",
                "Hoinka_proj_track_9_HVInIcePulses",
                "Hoinka_dist_std_HVInIcePulses",
                "Hoinka_stop_point_proj_9_HVInIcePulses",
                "Hoinka_n_pulses_InIcePulses",
                "Hoinka_dist_mean_TWSRTHVInIcePulses",
                "Hoinka_stop_point_z_9_TWSRTHVInIcePulses",
                "Hoinka_dist_mean_InIcePulses",
                "Hoinka_stop_point_proj_8_TWSRTHVInIcePulses",
                "Hoinka_dist_mean_HVInIcePulses",
                "Hoinka_charge_v2_TWSRTHVInIcePulses_corridor_out",
                "Hoinka_dirz_SplineMPE",
                "Hoinka_bins_frame_60_InIcePulses",
                "Hoinka_stop_point_proj_5_TWSRTHVInIcePulses",
                "Hoinka_diry_SplineMPE",
                "Hoinka_stop_point_z_6_HVInIcePulses",
                "Hoinka_dir_track_length_TWSRTHVInIcePulses",
                "Hoinka_bins_std_20_BS_TWSRTHVInIcePulses",
                "Hoinka_dh_smoothness_HVInIcePulses",
                "Hoinka_stop_point_r_8_HVInIcePulses",
                "Hoinka_cv_thsl_TWSRTHVInIcePulses",
                "Hoinka_cv_thds_InIcePulses",
                "Hoinka_cv_thds_HVInIcePulses",
                "Hoinka_cv_q_late_pulses_InIcePulses",
                "Hoinka_cog_z_HVInIcePulses",
                "Hoinka_cv_q_late_pulses_HVInIcePulses",
                "Hoinka_cv_q_early_pulses_HVInIcePulses",
                "Hoinka_bins_std_40_HVInIcePulses",
                "Hoinka_charge_v5_HVInIcePulses_all_out",
                "Hoinka_cv_n_late_strings_TWSRTHVInIcePulses",
                "Hoinka_energy_muex",
                "Hoinka_cv_n_late_pulses_TWSRTHVInIcePulses",
                "Hoinka_cv_n_late_pulses_HVInIcePulses",
                "Hoinka_cv_n_late_doms_TWSRTHVInIcePulses",
                "Hoinka_cv_n_late_doms_InIcePulses",
                "MuEXAngular4_Sigma",
                "Hoinka_cv_n_late_doms_HVInIcePulses",
                "Hoinka_bins_mean_40_TWSRTHVInIcePulses",
                "MPEFitParaboloid",
                "Hoinka_cv_n_early_strings_TWSRTHVInIcePulses",
                "Hoinka_cv_n_early_pulses_TWSRTHVInIcePulses",
                "Hoinka_cv_n_early_pulses_HVInIcePulses",
                "SRTHVInIcePulses_Qtot",
                "Hoinka_cv_n_early_doms_HVInIcePulses",
                "Hoinka_stop_point_z_4_InIcePulses",
                "Hoinka_cv_n_dir_strings_TWSRTHVInIcePulses",
                "SPEFit2_TWHV",
                "SPEFit2_HV",
                "Hoinka_cv_n_dir_strings_InIcePulses",
                "Hoinka_proj_track_2_TWSRTHVInIcePulses",
                "Hoinka_bins_std_20_InIcePulses",
                "Hoinka_cv_n_dir_strings_HVInIcePulses",
                "Hoinka_proj_track_7_HVInIcePulses",
                "Hoinka_cv_n_dir_pulses_TWSRTHVInIcePulses",
                "Hoinka_cv_n_dir_pulses_InIcePulses",
                "MPEFitHighNoise",
                "Hoinka_cv_n_dir_doms_InIcePulses",
                "BestTrackDirectHitsA",
                "Hoinka_bins_mean_80_HVInIcePulses",
                "Hoinka_dh_smoothness_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_5_TWSRTHVInIcePulses",
                "Hoinka_cv_addqtd_HVInIcePulses",
                "Hoinka_CR_varphi_SplineMPE",
                "Hoinka_convhull_vol_TWSRTHVInIcePulses",
                "Hoinka_stop_point_r_6_HVInIcePulses",
                "Hoinka_stop_point_proj_1_InIcePulses",
                "Hoinka_convhull_vol_InIcePulses",
                "Hoinka_charge_v0_HVInIcePulses_corridor_in",
                "Hoinka_charge_v5_InIcePulses_all_in",
                "Hoinka_emptybins_80_N_HVInIcePulses",
                "Hoinka_stop_point_z_7_HVInIcePulses",
                "Hoinka_convhull_surf_HVInIcePulses",
                "Hoinka_cog_z_InIcePulses",
                "Hoinka_cog_TWSRTHVInIcePulses",
                "Hoinka_cog_InIcePulses",
                "Hoinka_charge_v5_TWSRTHVInIcePulses_corridor_out",
                "Hoinka_z_travel_InIcePulses",
                "Hoinka_charge_v5_TWSRTHVInIcePulses_all_in",
                "Hoinka_bins_std_40_BS_HVInIcePulses",
                "Hoinka_charge_v5_InIcePulses_corridor_out",
                "Hoinka_bins_frame_40_HVInIcePulses",
                "Hoinka_charge_v5_InIcePulses_corridor_in",
                "Hoinka_bins_mean_40_BS_HVInIcePulses",
                "Hoinka_sphericalness_TWSRTHVInIcePulses",
                "Hoinka_charge_v5_InIcePulses_all_out",
                "Hoinka_charge_v5_HVInIcePulses_corridor_in",
                "Hoinka_charge_v5_HVInIcePulses_all_in",
                "Hoinka_charge_v4_TWSRTHVInIcePulses_corridor_out",
                "Hoinka_stop_point_proj_3_InIcePulses",
                "Hoinka_charge_v4_TWSRTHVInIcePulses_all_out",
                "BestTrack_AvgDistQ",
                "Hoinka_charge_v4_TWSRTHVInIcePulses_all_in",
                "Hoinka_emptybins_40_BS_TWSRTHVInIcePulses",
                "Hoinka_charge_v4_InIcePulses_corridor_in",
                "Hoinka_charge_v4_InIcePulses_all_out",
                "Hoinka_emptybins_60_BS_TWSRTHVInIcePulses",
                "SplineMPEDirectHitsB",
                "SplineMPE",
                "HiveSplitterReducedCount",
                "Hoinka_cv_n_late_pulses_InIcePulses",
                "Hoinka_charge_v4_HVInIcePulses_corridor_in",
                "Hoinka_cv_n_early_doms_InIcePulses",
                "Hoinka_charge_v4_HVInIcePulses_all_out",
                "Hoinka_charge_v3_TWSRTHVInIcePulses_corridor_in",
                "Hoinka_CR_varx_SplineMPE",
                "Hoinka_charge_v3_TWSRTHVInIcePulses_all_out",
                "Hoinka_charge_v3_TWSRTHVInIcePulses_all_in",
                "Hoinka_emptybins_40_N_HVInIcePulses",
                "Hoinka_charge_v3_InIcePulses_corridor_out",
                "SplineMPETruncatedEnergy_SPICEMie_ORIG_dEdX",
                "Hoinka_charge_v3_InIcePulses_corridor_in",
                "Hoinka_charge_v3_InIcePulses_all_out",
                "Hoinka_charge_v3_HVInIcePulses_corridor_in",
                "Hoinka_max_pulse_time_InIcePulses",
                "Hoinka_bins_mean_20_BS_HVInIcePulses",
                "Hoinka_dist_std_InIcePulses",
                "Hoinka_stop_point_r_8_TWSRTHVInIcePulses",
                "Hoinka_charge_v3_HVInIcePulses_all_in",
                "Hoinka_stop_point_proj_7_InIcePulses",
                "Hoinka_emptybins_120_TWSRTHVInIcePulses",
                "Hoinka_charge_v2_TWSRTHVInIcePulses_corridor_in",
                "Hoinka_charge_v2_InIcePulses_corridor_out",
                "Hoinka_n_pulses_HVInIcePulses",
                "Hoinka_charge_v2_InIcePulses_corridor_in",
                "Hoinka_charge_v2_InIcePulses_all_in",
                "Hoinka_charge_v2_HVInIcePulses_corridor_out",
                "Hoinka_charge_v2_HVInIcePulses_all_out",
                "Hoinka_charge_v2_HVInIcePulses_all_in",
                "Hoinka_charge_v1_TWSRTHVInIcePulses_corridor_in",
                "Hoinka_bins_mean_20_InIcePulses",
                "Hoinka_charge_v1_TWSRTHVInIcePulses_all_out",
                "Hoinka_closestappr_SplineMPE",
                "Hoinka_charge_v1_InIcePulses_corridor_out",
                "Hoinka_bins_mean_60_HVInIcePulses",
                "Hoinka_cv_n_late_strings_InIcePulses",
                "Hoinka_stop_point_r_6_InIcePulses",
                "Hoinka_charge_v1_HVInIcePulses_corridor_out",
                "Hoinka_charge_v1_HVInIcePulses_corridor_in",
                "Hoinka_charge_v1_HVInIcePulses_all_in",
                "Hoinka_charge_v0_TWSRTHVInIcePulses_corridor_out",
                "Hoinka_bins_mean_60_BS_HVInIcePulses",
                "Hoinka_proj_track_7_InIcePulses",
                "Hoinka_freelength_InIcePulses",
                "Hoinka_dir_track_length_InIcePulses",
                "Hoinka_charge_v0_TWSRTHVInIcePulses_corridor_in",
                "Hoinka_Labels",
                "Hoinka_stop_point_r_1_HVInIcePulses",
                "Hoinka_charge_v0_TWSRTHVInIcePulses_all_out",
                "Hoinka_charge_v0_InIcePulses_corridor_out",
                "Hoinka_charge_v0_InIcePulses_corridor_in",
                "Hoinka_charge_v0_InIcePulses_all_out",
                "Hoinka_charge_cog_z_TWSRTHVInIcePulses",
                "Hoinka_charge_v0_InIcePulses_all_in",
                "Hoinka_stop_point_z_8_InIcePulses",
                "Hoinka_max_pulse_time_TWSRTHVInIcePulses",
                "Hoinka_emptybins_40_BS_HVInIcePulses",
                "Hoinka_charge_v0_HVInIcePulses_all_in",
                "Hoinka_charge_cog_r_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_60_HVInIcePulses",
                "Hoinka_bins_std_80_TWSRTHVInIcePulses",
                "Hoinka_bins_std_80_InIcePulses",
                "Hoinka_cv_addqtd_TWSRTHVInIcePulses",
                "Hoinka_bins_std_20_BS_InIcePulses",
                "Hoinka_bins_std_80_BS_TWSRTHVInIcePulses",
                "Hoinka_proj_track_5_InIcePulses",
                "Hoinka_bins_std_80_BS_InIcePulses",
                "Hoinka_bins_std_60_InIcePulses",
                "Hoinka_bins_std_60_HVInIcePulses",
                "Hoinka_min_pulse_time_TWSRTHVInIcePulses",
                "Hoinka_charge_v1_HVInIcePulses_all_out",
                "Hoinka_bins_std_60_BS_TWSRTHVInIcePulses",
                "Hoinka_bins_std_60_BS_InIcePulses",
                "Hoinka_cv_q_late_pulses_TWSRTHVInIcePulses",
                "Hoinka_bins_std_40_InIcePulses",
                "Hoinka_stop_point_z_2_HVInIcePulses",
                "Hoinka_Qdensity_InIcePulses",
                "Hoinka_energy_trun_AD_mu",
                "Hoinka_convhull_surf_TWSRTHVInIcePulses",
                "Hoinka_bins_std_40_BS_InIcePulses",
                "Hoinka_stop_point_r_8_InIcePulses",
                "Hoinka_proj_track_1_TWSRTHVInIcePulses",
                "Hoinka_stop_point_proj_7_HVInIcePulses",
                "Hoinka_de_dx",
                "SplineMPEFitParams",
                "Hoinka_bins_std_20_TWSRTHVInIcePulses",
                "Hoinka_bins_std_20_BS_HVInIcePulses",
                "Hoinka_bins_std_120_TWSRTHVInIcePulses",
                "Hoinka_bins_std_120_HVInIcePulses",
                "Hoinka_cv_ehtl_InIcePulses",
                "Hoinka_bins_std_120_BS_TWSRTHVInIcePulses",
                "Hoinka_cog_HVInIcePulses",
                "Hoinka_bins_std_120_BS_HVInIcePulses",
                "Hoinka_bins_std_100_TWSRTHVInIcePulses",
                "Hoinka_bins_std_100_InIcePulses",
                "Hoinka_emptybins_120_N_InIcePulses",
                "Hoinka_bins_std_100_HVInIcePulses",
                "Hoinka_bins_std_100_BS_TWSRTHVInIcePulses",
                "Hoinka_time_frame_TWSRTHVInIcePulses",
                "Hoinka_bins_std_100_BS_HVInIcePulses",
                "Hoinka_bins_std_80_BS_HVInIcePulses",
                "Hoinka_bins_mean_80_TWSRTHVInIcePulses",
                "Hoinka_emptybins_20_N_InIcePulses",
                "Hoinka_bins_mean_80_InIcePulses",
                "Hoinka_bins_std_60_BS_HVInIcePulses",
                "Hoinka_bins_mean_80_BS_InIcePulses",
                "Hoinka_dirx_SplineMPE",
                "Hoinka_bins_mean_80_BS_HVInIcePulses",
                "Hoinka_bins_mean_60_InIcePulses",
                "Hoinka_z_max_HVInIcePulses",
                "Hoinka_bins_mean_60_BS_TWSRTHVInIcePulses",
                "SplineMPETruncatedEnergy_SPICEMie_AllDOMS_MuEres",
                "Hoinka_bins_mean_60_BS_InIcePulses",
                "Hoinka_charge_v4_TWSRTHVInIcePulses_corridor_in",
                "Hoinka_charge_v1_InIcePulses_all_out",
                "Hoinka_charge_v1_TWSRTHVInIcePulses_corridor_out",
                "Hoinka_charge_v4_InIcePulses_all_in",
                "Hoinka_bins_mean_40_HVInIcePulses",
                "Hoinka_bins_mean_40_BS_TWSRTHVInIcePulses",
                "Hoinka_charge_v2_TWSRTHVInIcePulses_all_in",
                "SplineMPEDirectHitsA",
                "Hoinka_bins_mean_40_BS_InIcePulses",
                "Hoinka_bins_mean_20_TWSRTHVInIcePulses",
                "Hoinka_charge_v3_InIcePulses_all_in",
                "Hoinka_bins_mean_20_BS_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_20_BS_InIcePulses",
                "Hoinka_charge_cog_z_HVInIcePulses",
                "Hoinka_bins_mean_120_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_120_BS_TWSRTHVInIcePulses",
                "Hoinka_proj_std_InIcePulses",
                "Hoinka_bins_mean_60_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_120_InIcePulses",
                "Hoinka_bins_mean_120_HVInIcePulses",
                "Hoinka_CR_covthetax_SplineMPE",
                "Hoinka_bins_mean_120_BS_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_120_BS_InIcePulses",
                "Hoinka_emptybins_100_N_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_120_BS_HVInIcePulses",
                "Hoinka_bins_std_120_BS_InIcePulses",
                "Hoinka_bins_mean_100_TWSRTHVInIcePulses",
                "Hoinka_bins_mean_100_InIcePulses",
                "Hoinka_charge_cog_z_InIcePulses",
                "Hoinka_emptybins_60_TWSRTHVInIcePulses",
                "Hoinka_charge_cog_r_HVInIcePulses",
                "Hoinka_bins_frame_80_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_80_BS_HVInIcePulses",
                "Hoinka_charge_v0_HVInIcePulses_corridor_out",
                "Hoinka_bins_frame_60_TWSRTHVInIcePulses",
                "Hoinka_n_hit_doms_HVInIcePulses",
                "Hoinka_cv_q_early_pulses_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_60_BS_InIcePulses",
                "Hoinka_bins_frame_40_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_40_InIcePulses",
                "Hoinka_cv_n_early_strings_HVInIcePulses",
                "Hoinka_bins_frame_40_BS_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_40_BS_HVInIcePulses",
                "Hoinka_bins_frame_20_InIcePulses",
                "Hoinka_bins_frame_20_HVInIcePulses",
                "Hoinka_bins_frame_20_BS_TWSRTHVInIcePulses",
                "Hoinka_cv_thsl_HVInIcePulses",
                "Hoinka_bins_frame_20_BS_InIcePulses",
                "MPEFitHighNoiseFitParams",
                "Hoinka_emptybins_120_BS_InIcePulses",
                "Hoinka_dh_smoothness_InIcePulses",
                "Hoinka_bins_std_100_BS_InIcePulses",
                "Hoinka_bins_frame_120_InIcePulses",
                "Hoinka_bins_frame_120_HVInIcePulses",
                "Hoinka_bins_frame_80_BS_InIcePulses",
                "Hoinka_bins_frame_120_BS_InIcePulses",
                "Hoinka_cv_n_late_strings_HVInIcePulses",
                "Hoinka_bins_frame_120_BS_HVInIcePulses",
                "Hoinka_bins_frame_80_HVInIcePulses",
                "Hoinka_bins_frame_100_InIcePulses",
                "Hoinka_n_hit_doms_TWSRTHVInIcePulses",
                "Hoinka_emptybins_120_N_TWSRTHVInIcePulses",
                "Hoinka_bins_frame_100_BS_InIcePulses",
                "Hoinka_bins_frame_100_BS_HVInIcePulses",
                "Hoinka_charge_v5_HVInIcePulses_corridor_out",
                "Hoinka_azimuth_SplineMPE",
                "Hoinka_emptybins_40_TWSRTHVInIcePulses",
                "Hoinka_charge_v3_TWSRTHVInIcePulses_corridor_out",
                "Hoinka_Qdensity_HVInIcePulses",
                "Hoinka_charge_v0_HVInIcePulses_all_out",
                "Hoinka_cv_thds_TWSRTHVInIcePulses",
                "Hoinka_charge_v0_TWSRTHVInIcePulses_all_in",
                "Hoinka_CR_vary_SplineMPE",
                "Hoinka_stop_point_z_5_TWSRTHVInIcePulses",
                "Hoinka_cv_n_dir_pulses_HVInIcePulses",
                "Hoinka_CR_vartheta_SplineMPE",
                "Hoinka_bins_frame_60_BS_HVInIcePulses",
                "Hoinka_CR_theta_SplineMPE",
                "Hoinka_cv_n_dir_doms_HVInIcePulses",
                "Hoinka_CR_phi_SplineMPE",
                "Hoinka_charge_cog_r_InIcePulses",
                "Hoinka_charge_v2_InIcePulses_all_out",
                "Hoinka_CR_covxy_SplineMPE",
                "Hoinka_cog_z_TWSRTHVInIcePulses",
                "Hoinka_bins_std_40_TWSRTHVInIcePulses",
                "Hoinka_CR_covthetay_SplineMPE",
                "Hoinka_bins_std_80_HVInIcePulses",
                "Hoinka_CR_covthetaphi_SplineMPE",
                "Hoinka_charge_v1_InIcePulses_corridor_in",
                "Hoinka_bins_frame_40_BS_InIcePulses",
                "Hoinka_bins_frame_100_TWSRTHVInIcePulses",
                "HitStatisticsValuesIC",
                "HitStatisticsValues",
                "HitMultiplicityValuesIC",
                "HitMultiplicityValues",
                "BestTrackDirectHitsICE",
                "Hoinka_bins_frame_60_BS_TWSRTHVInIcePulses",
                "BestTrackDirectHitsICD",
                "Hoinka_stop_point_proj_4_TWSRTHVInIcePulses",
                "BestTrackDirectHitsICC",
                "Hoinka_CR_covphix_SplineMPE",
                "LineFit_HVParams",
                "BestTrackDirectHitsICA",
                "Hoinka_emptybins_40_N_InIcePulses",
                "SplineMPEDirectHitsICD",
                "Hoinka_z_min_TWSRTHVInIcePulses",
                "Hoinka_emptybins_100_BS_InIcePulses",
                "Hoinka_charge_v4_HVInIcePulses_corridor_out",
                "SplineMPEDirectHitsICC",
                "BestTrackDirectHitsC",
                "SplineMPEDirectHitsICB",
                "BestTrackDirectHitsB",
                "SplineMPEDirectHitsICA",
                "Hoinka_emptybins_120_BS_TWSRTHVInIcePulses",
                "Hoinka_z_sigma_HVInIcePulses",
                "BestTrackCramerRaoParams",
                "BestTrackCharacteristicsIC",
                "Hoinka_charge_v1_TWSRTHVInIcePulses_all_in",
                "BestTrack",
                "Hoinka_cv_n_dir_doms_TWSRTHVInIcePulses"]

        if mgs is True:
                print("Adding MuonWeight to keys list.")
                keys += ["MuonWeight"]

        if nu is True:
                print("Adding I3MCWeightDict to keys list.")
                keys += ["I3MCWeightDict"]

    tray = I3Tray()

    tray.AddModule("I3Reader", "reader", FilenameList=glob.glob(input))
    print("Reading from %s" % (input))
    tray.AddModule(
        I3TableWriter,
        "writer",
        tableservice=I3HDFTableService(output),
        keys=keys,
        SubEventStreams=["Final"])

    tray.AddModule("TrashCan", "trash")
    tray.Execute()
    tray.Finish()


if __name__ == "__main__":
    args = docopt(__doc__, version="HD5 Writer")
    main(args["INPUT"], args["OUTPUT"], args["--exp"], args["--mgs"], args["--nu"])
